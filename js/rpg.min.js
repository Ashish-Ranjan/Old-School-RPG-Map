/* ***** BEGIN LICENSE BLOCK *****
 * Version: MPL 1.1/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 1.1 (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * The Original Code is Old School RPG Map.
 *
 * The Initial Developer of the Original Code is Jono Xia.
 * Portions created by the Initial Developer are Copyright (C) 2007
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 *   Jono Xia <jono@mozilla.com>
 *   Gaurav Munjal <Gaurav0@aol.com>
 *   Jebb Burditt <jebb.burditt@gmail.com>
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 2 or later (the "GPL"), or
 * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** */
 function bW(a,c){var g=new b(a,c,!1),i=cG;bx.addSubMap(i,g);var j=g.getXLimit(),k=g.getYLimit(),l=new Image;l.src="images/meadow.png";for(var m=0;m<j;++m)for(var n=0;n<k;++n){var o=g.getSquareAt(m,n);o.passable()&&(o.onEnter=function(){Math.random()<bl&&(bO=0,bC=new Y,bC.setupRandomEncounter("forest",l),bC.draw())})}for(var m=0;m<j;++m)for(var n=0;n<k;++n)if(n==k-1){var o=g.getSquareAt(m,n);o.onEnter=function(){bx.goToMap(bw,0,13,9,7,4,h)}}bx.getSubMap(0).getSquareAt(13,9).onEnter=function(){bx.goToMap(bw,i,9,28,3,19,f)},bD=new Image,bD.src="images/Chest2.png";var p=new e(3,27,i,"fc1");p.action=function(){this.onOpenFindItem("You found 5 potions.",cb,5)},g.addSprite(p);var q=new e(17,11,i,"fc2");q.action=function(){this.onOpenFindItem("You found 3 bombs.",cc,3)},g.addSprite(q);var r=new e(16,2,i,"fc3");r.action=function(){this.onOpenLearnSpell(cJ)},g.addSprite(r);var s=new e(3,7,i,"fc4");s.action=function(){this.onOpenLearnSpell(cK)},g.addSprite(s);var t=new d(11,7,32,58,by,i,664,249);t.action=function(){bz.setCallback(function(){bO=0,bC=new Y,bC.setupEncounter("A rat king",[10],l),bC.onWin=function(){bv.setFlag("fb"),t.clear(),g.removeSprite(t)},bC.draw()}),bz.displayText("I am the rat king.\nI rule this domain.\nPrepare to die.")},g.addSprite(t),bv.addLoadFunction(function(){bv.isFlagSet("fb")?(t.clear(),g.removeSprite(t)):g.hasSprite(t)||g.addSprite(t)})}function bV(a,c,d){var e=new b(a,c,!1),k=cF;bx.addSubMap(k,e);var l=e.getXLimit(),m=e.getYLimit();for(var n=0;n<l;++n)for(var o=0;o<m;++o)if(o==m-1){var p=e.getSquareAt(n,o);p.onEnter=function(){bx.goToMap(bw,d,12,12,6,7,h)}}for(var q=11;q<=13;++q)bx.getSubMap(d).getSquareAt(q,12).onEnter=function(){bx.goToMap(bw,k,10,18,4,9,f)};var r=new Image,s=new j(1,8,r,k,g);r.src="images/Man1.png",s.action=function(){bz.setCallback(function(){bB.displayShop([cf,cg,ch,ci])}),bz.displayText("Welcome to the weapon shop.")},e.addSprite(s);var t=new Image,u=new j(18,8,t,k,i);t.src="images/Man2.png",u.action=function(){bz.setCallback(function(){bB.displayShop([cm,cn,co,cr,cs,ct,cw,cx,cy])}),bz.displayText("Welcome to the armor shop.")},e.addSprite(u);var v=new Image,w=new j(1,12,v,k,g);v.src="images/Woman2.png",w.action=function(){bz.setCallback(function(){bB.displayShop([cb,cc,cd])}),bz.displayText("Welcome to the item shop.")},e.addSprite(w);var x=new Image,y=new j(10,12,x,k,h);x.src="images/Woman1.png",y.action=function(){this.facePlayer(),bz.displayText("Welcome to the castle's tavern.")},e.addSprite(y);var z=new Image,A=new j(16,17,z,k,i);z.src="images/Boy.png",A.action=function(){this.facePlayer();var a="Whenever I return to the castle,\n";a+="I feel completely refreshed and\nrestored.",bz.displayText(a)},e.addSprite(A),e.getSquareAt(3,8).onAction=function(){bw.getDir()==i&&s.action()},e.getSquareAt(16,8).onAction=function(){bw.getDir()==g&&u.action()},e.getSquareAt(3,12).onAction=function(){bw.getDir()==i&&w.action()}}function bU(a,c){var d=new b(a,c,!1),e=cE;bx.addSubMap(e,d);var g=d.getXLimit(),i=d.getYLimit();for(var k=0;k<g;++k)for(var l=0;l<i;++l)if(k==0||l==0||k==g-1||l==i-1){var n=d.getSquareAt(k,l);n.onEnter=function(){bx.goToMap(bw,0,23,14,17,9,h)}}bx.getSubMap(0).getSquareAt(23,14).onEnter=function(){bx.goToMap(bw,e,12,18,6,9,f),bw.restore()};var o=new Image,p=new j(10,14,o,e,h);o.src="images/Soldier2.png",p.action=function(){this.facePlayer(),bz.displayText("You may enter the castle now.")},d.addSprite(p);var q=new j(14,14,o,e,h);q.action=function(){this.facePlayer(),bz.displayText("But the interior is still under\nconstruction.")},d.addSprite(q);var r="images/Inq XP MI- Medieval Indoors.png",s=new Image,t=new m(256,8704,r,s);s.src=r,s.onload=function(){bE("CastleShops.tmx.xml",function(a){bV(a,t,e)})}}function bT(){if(bO&&!bC&&!bx.isAnimating()){var a=bO;bO=0;switch(a){case bH:bw.move(0,1,h);break;case bI:bw.move(0,-1,f);break;case bK:bw.move(1,0,g);break;case bJ:bw.move(-1,0,i);break;case bL:case bM:bz.textDisplayed()?bz.clearText():bx.doAction()}}}function bS(a,b){if(bx&&bw)if(bx.isAnimating())bO=a,b.preventDefault();else switch(a){case bH:bA.menuDisplayed()?bA.handleInput(a):bB.shopDisplayed()?bB.handleInput(a):bC?bC.handleInput(a):bx.isAnimating()||bw.move(0,1,h),b.preventDefault();break;case bI:bA.menuDisplayed()?bA.handleInput(a):bB.shopDisplayed()?bB.handleInput(a):bC?bC.handleInput(a):bx.isAnimating()||bw.move(0,-1,f),b.preventDefault();break;case bK:bA.menuDisplayed()?bA.handleInput(a):bB.shopDisplayed()?bB.handleInput(a):bC?bC.handleInput(a):bx.isAnimating()||bw.move(1,0,g),b.preventDefault();break;case bJ:bA.menuDisplayed()?bA.handleInput(a):bB.shopDisplayed()?bB.handleInput(a):bC?bC.handleInput(a):bx.isAnimating()||bw.move(-1,0,i),b.preventDefault();break;case bL:case bM:bz.textDisplayed()?bz.clearText():bA.menuDisplayed()?bA.handleEnter():bB.shopDisplayed()?bB.handleEnter():bC?bC.handleEnter():bx.isAnimating()||(bx.doAction(),bw.getSquareUnderfoot().onAction()),b.preventDefault();break;case bN:bz.textDisplayed()?bz.clearText():bA.menuDisplayed()?bA.handleEsc():bB.shopDisplayed()?bB.handleEsc():bC?bC.handleEsc():bA.displayMenu(),b.preventDefault()}}function bR(){bP=!1,bC&&bC.handleKeyUp()}function bQ(a){if(!a.ctrlKey&&!a.altKey&&!a.metaKey){var b=a.keyCode?a.keyCode:a.charCode?a.charCode:0;bP=!0,bS(b,a)}}function bG(a,b,c,d,e,f,g){a.lineWidth=g,a.strokeStyle="white";var h=b+2*g,i=c+2*g,j=b+d-2*g,k=c+e-2*g;a.beginPath(),a.moveTo(h+f,i),a.lineTo(j-f,i),a.quadraticCurveTo(j,i,j,i+f),a.lineTo(j,k-f),a.quadraticCurveTo(j,k,j-f,k),a.lineTo(h+f,k),a.quadraticCurveTo(h,k,h,k-f),a.lineTo(h,i+f),a.quadraticCurveTo(h,i,h+f,i),a.closePath(),a.shadowOffsetX=g/2,a.shadowOffsetY=g/2,a.shadowBlur=g,a.shadowColor="rgba(0, 0, 0, 0.5)";var l=a.createLinearGradient(b,c,b,c+e);l.addColorStop(0,"#0066FF"),l.addColorStop(1,"#000099"),a.fillStyle=l,a.fill(),a.stroke(),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor="transparent"}function bF(a){bC?bC.writeMsg(a):bz.displayText(a)}function bE(a,b){$.ajax({type:"GET",url:a,dataType:"xml",success:b,error:function(a,b,c){alert("error:"+b)}})}var a=Class.extend({_init:function(a,b,c,d,e){this._subMap=a,this._x=b,this._y=c,this._passable=d,this._zone=e},getX:function(){return this._x},getY:function(){return this._y},passable:function(){return this._passable},getZone:function(){return this._zone},onEnter:function(a){},onAction:function(a){}}),b=Class.extend({_init:function(b,c,d){this._layer=$(b).find("map layer").eq(0),this._xLimit=parseInt($(this._layer).attr("width")),this._yLimit=parseInt($(this._layer).attr("height")),this._mapXml=b,this._tileset=c,this._overworld=d,this._spriteList=[],this._mapSquares=[];var e=$(b).find('layer[name="Base"]').find("tile"),f=$(b).find('layer[name="Impassable"]').find("tile"),g=$(b).find('layer[name="Zones"]');g.length>0&&(g=g.find("tile"));for(var h=0;h<this._yLimit;h++){var i=[];for(var j=0;j<this._xLimit;j++){var k=h*this._xLimit+j,l=parseInt(e.eq(k).attr("gid"))!=87;l=l&&parseInt(f.eq(k).attr("gid"))==0;var m=0;g.length>0&&(m=parseInt(g.eq(k).attr("gid")),m>0&&(m-=288));var n=new a(this,j,h,l,m);i.push(n)}this._mapSquares.push(i)}},getXLimit:function(){return this._xLimit},getYLimit:function(){return this._yLimit},getTileset:function(){return this._tileset},isOverWorld:function(){return this._overworld},pointInBounds:function(a,b){if(a<0||a>=this._xLimit)return!1;if(b<0||b>=this._yLimit)return!1;return!0},isPassable:function(a,b){return this._mapSquares[b][a].passable()},isOccupied:function(a,b){var c=!1;for(var d=0;d<this._spriteList.length;++d){var e=this._spriteList[d];e.isAt(a,b)&&(c=!0)}return c},getSquareAt:function(a,b){if(!this.pointInBounds(a,b))return null;return this._mapSquares[b][a]},addSprite:function(a){this._spriteList.push(a);return this._spriteList.length-1},removeSprite:function(a){var b;for(var c=0;c<this._spriteList.length;++c)this._spriteList[c]==a&&(b=c);this._spriteList.splice(b,1)},hasSprite:function(a){for(var b=0;b<this._spriteList.length;++b)if(this._spriteList[b]==a)return!0;return!1},getSpriteAt:function(a,b){for(var c=0;c<this._spriteList.length;++c){var d=this._spriteList[c];if(d.isAt(a,b))return d}return null},onEnter:function(){},onExit:function(){},drawSprites:function(){for(var a=0;a<this._spriteList.length;++a)this._spriteList[a].plot()},clearSprites:function(){for(var a=0;a<this._spriteList.length;++a)this._spriteList[a].clear()},doAction:function(){var a=bw.getFacingCoords(),b=a[0],c=a[1],d=this.getSpriteAt(b,c);d!=null&&d.action()},redraw:function(a,b,c,d){var e=this._xLimit,f=this._tileset,g=c>0?-1:0,h=d>0?-1:0,i=c<0?bb+1:bb,j=d<0?bc+1:bc;$(this._mapXml).find("map layer").each(function(){var k=$(this).attr("visible");if(k!="0"){var l=$(this).find("tile");for(var m=h;m<j;++m)for(var n=g;n<i;++n){var o=(m+b)*e+n+a,p=l.eq(o).attr("gid");p>0&&f.drawClip(p,n,m,c,d)}}})},animate:function(a,b,c,d){bx.startAnimating(),bx.startScrolling();var e=c-a,f=d-b,g=(f!=0?ba:_)/bk,h=this;window.setTimeout(function(){h.animateSub(a,b,0,0,e,f,g)},1)},animateSub:function(a,b,c,d,e,f,g){if(g>0){for(var h=0;h<this._spriteList.length;++h)this._spriteList[h].clear(c+e*_,d+f*ba);c-=e*bk,d-=f*bk;for(var h=0;h<this._spriteList.length;++h)this._spriteList[h].plot(0,0,c+e*_,d+f*ba);this._lastOffsetX=c+e*_,this._lastOffsetY=d+f*ba}this.redraw(a,b,c,d);if(g>0){var i=this;window.setTimeout(function(){i.animateSub(a,b,c,d,e,f,--g)},1e3/bj)}else bx.finishAnimating(),bx.finishScrolling(),this._lastOffsetX=undefined,this._lastOffsetY=undefined,window.setTimeout(bT,1e3/bj)}}),c=Class.extend({_init:function(a,c){this._subMapList=[],this._currentSubMap=0,this._scrollX=0,this._scrollY=0;var d=new b(a,c,!0);this._subMapList[0]=d,this._animating=!1,this._scrolling=!1,this._runAfterAnimation=null},getSubMap:function(a){return this._subMapList[a]},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},getCurrentSubMapId:function(){return this._currentSubMap},getXLimit:function(){return this._subMapList[this._currentSubMap].getXLimit()},getYLimit:function(){return this._subMapList[this._currentSubMap].getYLimit()},isOverWorld:function(){return this._subMapList[this._currentSubMap].isOverWorld()},pointInBounds:function(a,b){return this._subMapList[this._currentSubMap].pointInBounds(a,b)},isPassable:function(a,b){return this._subMapList[this._currentSubMap].isPassable(a,b)},isOccupied:function(a,b){return this._subMapList[this._currentSubMap].isOccupied(a,b)},getSquareAt:function(a,b){var c=this._subMapList[this._currentSubMap].getSquareAt(a,b);return c},transform:function(a,b){var c=_*(a-this._scrollX),d=ba*(b-this._scrollY);return[c,d]},isOnScreen:function(a,b){var c=a-this._scrollX,d=b-this._scrollY;return c>=-1&&c<=bb&&d>=-1&&d<=bc},autoScrollToPlayer:function(a,b){var c=!1,d=a-this._scrollX,e=b-this._scrollY,f=0;d<bd?c=this.scroll(d-bd,0)||c:d>be&&(c=this.scroll(d-be,0)||c),e<bf?c=this.scroll(0,e-bf)||c:e>bg&&(c=this.scroll(0,e-bg)||c);return c},scroll:function(a,b){var c=this._scrollX+a,d=this._scrollY+b,e=this.getXLimit(),f=this.getYLimit();c<0&&(c=0),c+bb>e&&(c=e-bb),d<0&&(d=0),d+bc>f&&(d=f-bc);if(c!=this._scrollX||d!=this._scrollY){this.animate(c,d),this._scrollX=c,this._scrollY=d;return!0}return!1},redraw:function(){this._subMapList[this._currentSubMap].redraw(this._scrollX,this._scrollY,0,0)},animate:function(a,b){this._subMapList[this._currentSubMap].animate(this._scrollX,this._scrollY,a,b)},addSubMap:function(a,b){this._subMapList[a]=b},goToMap:function(a,b,c,d,e,f,g){a.clear();var h=this._subMapList[this._currentSubMap];h.onExit(),h.clearSprites(),this._currentSubMap=b,a.enterNewSubMap(b,c,d,g),this.goTo(e,f);var i=this._subMapList[b];i.drawSprites(),i.onEnter(),a.plot()},goTo:function(a,b){this._scrollX=a,this._scrollY=b,this.redraw()},doAction:function(){this._subMapList[this._currentSubMap].doAction()},drawSprites:function(){this._subMapList[this._currentSubMap].drawSprites()},clearSprites:function(){this._subMapList[this._currentSubMap].clearSprites()},isAnimating:function(){return this._animating},startAnimating:function(){this._animating=!0},finishAnimating:function(){this._animating=!1,this._runAfterAnimation&&(this._runAfterAnimation(),this._runAfterAnimation=null)},isScrolling:function(){return this._scrolling},startScrolling:function(){this._scrolling=!0},finishScrolling:function(){this._scrolling=!1},runAfterAnimation:function(a){this._runAfterAnimation=a},createSaveData:function(){return{scrollX:this._scrollX,scrollY:this._scrollY}},loadSaveData:function(a){this._scrollX=a.scrollX,this._scrollY=a.scrollY}}),d=Class.extend({_init:function(a,b,c,d,e,f,g,h){this._x=a,this._y=b,this._width=c,this._height=d,this._subMap=f,this._img=e,this._sx=g!=undefined?g:0,this._sy=h!=undefined?h:0},getX:function(){return this._x},getY:function(){return this._y},getSubMap:function(){return this._subMap},isAt:function(a,b){return this._x==a&&this._y==b},plot:function(a,b,c,d){if(bx.getCurrentSubMapId()==this._subMap){if(!bx.isOnScreen(this._x,this._y))return;var e=this._width,f=this._height,g=this._width,h=this._height,i=bx.getSubMap(this._subMap);i.isOverWorld()&&(g=Math.ceil(_*ba/bi),h=ba);var j=bx.transform(this._x,this._y),k=j[0],l=j[1];k+=Math.floor((_-g)/2),l+=ba-h;var m=this._sx;a!=undefined&&(m+=a);var n=this._sy;b!=undefined&&(n+=b),c!=undefined&&(k+=c),d!=undefined&&(l+=d),bq.drawImage(this._img,m,n,e,f,k,l,g,h);if(!i.isOverWorld())if(this==bw){var o=i.getSpriteAt(this._x,this._y+1);o!=null&&(bx.isScrolling()?i._lastOffsetX!=undefined&&o.plot(0,0,i._lastOffsetX,i._lastOffsetY):o.plot());var o=i.getSpriteAt(this._prevX,this._prevY+1);o!=null&&(bx.isScrolling()?i._lastOffsetX!=undefined?o.plot(0,0,i._lastOffsetX,i._lastOffsetY):o.plot(0,0,(this._x-this._prevX)*_,(this._y-this._prevY)*ba):o.plot())}else bw.isAt(this._x,this._y+1)&&bw.plot()}},clear:function(a,b){if(bx.getCurrentSubMapId()==this._subMap){if(!bx.isOnScreen(this._x,this._y))return;var c=bx.transform(this._x,this._y),d=c[0],e=c[1],f=this._width,g=this._height,h=bx.getSubMap(this._subMap);h.isOverWorld()&&(f=Math.ceil(_*ba/bi),g=ba),d+=Math.floor((_-f)/2),e+=ba-g,a!=undefined&&(d+=a),b!=undefined&&(e+=b),bq.clearRect(d,e,f,g);if(!h.isOverWorld())if(this==bw){var i=h.getSpriteAt(this._x,this._y-1);i!=null&&i.plot();var i=h.getSpriteAt(this._prevX,this._prevY-1);i!=null&&i.plot();var j=h.getSpriteAt(this._prevX,this._prevY+1);j!=null&&j.plot()}else bx.isScrolling()||(bw.isAt(this._x,this._y-1)&&bw.plot(),bw.isAt(this._x,this._y+1)&&bw.plot())}},action:function(){}}),e=d.extend({_init:function(a,b,c,d){this._super(a,b,_,ba,bD,c),this._flagName=d,this._open=!1;var e=this;bv.addLoadFunction(function(){bv.isFlagSet(e._flagName)?e._open=!0:e._open=!1})},isOpen:function(){return this._open},open:function(){this.clear(),this._open=!0,bv.setFlag(this._flagName),this.plot()},plot:function(a,b,c,d){var e=0;this._open&&(e=_),this._super(e,0,c,d)},onOpenFindItem:function(a,b,c){this.isOpen()||(this.open(),bw.addToInventory(b,c),bz.displayText(a))},onOpenLearnSpell:function(a){if(!this.isOpen()){this.open(),bw.learnSpell(a);var b="You found a spell book.\n",c=cL.spells[a].name;b+="You learned "+c+".",bz.displayText(b)}}}),f=0,g=1,h=2,i=3,j=d.extend({_init:function(a,b,c,d,e){this._super(a,b,bh,bi,c,d),this._dir=e,this._walking=!1,this._entered=!1},getDir:function(){return this._dir},getFacingCoords:function(){var a=this._x,b=this._y;switch(this._dir){case f:b--;break;case h:b++;break;case i:a--;break;case g:a++}return[a,b]},facePlayer:function(){switch(bw.getDir()){case f:this._dir=h;break;case h:this._dir=f;break;case i:this._dir=g;break;case g:this._dir=i}this.clear(),this.plot()},plot:function(a,b,c,d){if(!this._walking||c!==undefined||d!==undefined){var e=bi*this._dir,f=bh;a!=undefined&&(f+=a),this._super(f,e,c,d)}},move:function(a,b,c){this._dir=c;var d=this._x+a,e=this._y+b;if(!bx.pointInBounds(d,e)||!bx.isPassable(d,e)||bx.isOccupied(d,e)){bx.isAnimating()||(this.clear(),this.plot());return!1}this.clear(),this._prevX=this._x,this._prevY=this._y,this._x+=a,this._y+=b;if(this==bw){var f=bx.autoScrollToPlayer(this._x,this._y);f?this.scrollAnimation():this.walkAnimation(a,b),this._entered=!1;var g=this;bx.runAfterAnimation(function(){g._entered||g.getSquareUnderfoot().onEnter(),g._entered=!0})}return!0},enterNewSubMap:function(a,b,c,d){this._x=b,this._y=c,this._dir=d,this._subMap=a},getSquareUnderfoot:function(){return bx.getSquareAt(this._x,this._y)},scrollAnimation:function(){bx.isAnimating()&&this.scrollAnimationSub(0)},scrollAnimationSub:function(a){if(bx.isAnimating()&&!bC){var b=0;a==1?b=-bh:a==3&&(b=bh),this.plot(b);var c=this;window.setTimeout(function(){c.scrollAnimationSub((a+1)%4)},1e3/bj)}else bC||(this.clear(),this.plot())},walkAnimation:function(a,b){if(bx.isAnimating()){var c=this;window.setTimeout(function(){c.walkAnimationPoll(a,b)},1e3/bj)}else if(!bC){bx.startAnimating(),this._walking=!0;var d=(b!=0?ba:_)/bk,e=-a*_,f=-b*ba;this.walkAnimationSub(0,a,b,e,f,d)}},walkAnimationPoll:function(a,b){if(bx.isAnimating()){var c=this;window.setTimeout(function(){c.walkAnimationPoll(a,b)},1e3/bj)}else this.walkAnimation(a,b)},walkAnimationSub:function(a,b,c,d,e,f){if(f>1&&!bC){this.clear(d,e);var g=0;a==1?g=-bh:a==3&&(g=bh),d+=b*bk,e+=c*bk,this.plot(g,0,d,e);var h=this;window.setTimeout(function(){h.walkAnimationSub((a+1)%4,b,c,d,e,--f)},1e3/bj)}else this._walking=!1,bC||(this.clear(d,e),this.plot(),window.setTimeout(bT,1e3/bj)),bx.finishAnimating()}}),k=j.extend({_init:function(a,b,c,d,e,f){this._super(a,b,c,d,e),this._player=cN.players[f],this._name=this._player.name,this._exp=this._player.exp,this._gold=this._player.gold,this._level=this._player.level,this._maxHP=this._player.maxHP,this._maxMP=this._player.maxMP,this._hp=this._player.maxHP,this._mp=this._player.maxMP,this._attack=this._player.attack,this._defense=this._player.defense,this._levels=this._player.levels,this._weapon=this._player.weapon,this._armor=this._player.armor,this._helmet=this._player.helmet,this._shield=this._player.shield,this._inventory=this._player.inventory,this._spells=this._player.spells},getName:function(){return this._name},getExp:function(){return this._exp},getNextExp:function(){return this._levels[this._level]},getGold:function(){return this._gold},getMaxHP:function(){return this._maxHP},getMaxMP:function(){return this._maxMP},getHP:function(){return this._hp},getMP:function(){return this._mp},getAttack:function(){return this._attack+cA.items[this._weapon].attack},getDefense:function(){return this._defense+cA.items[this._armor].defense+cA.items[this._helmet].defense+cA.items[this._shield].defense},getLevel:function(){return this._level},getWeapon:function(){return this._weapon},getArmor:function(){return this._armor},getHelmet:function(){return this._helmet},getShield:function(){return this._shield},isDead:function(){return this._hp<=0},damage:function(a){this._hp-=a},heal:function(a){this._hp+=a,this._hp>this._maxHP&&(this._hp=this._maxHP)},useMP:function(a){this._mp-=a},gainMP:function(a){this._mp+=a,this._mp>this._maxMP&&(this._mp=this._maxMP)},restore:function(){this._hp=this._maxHP,this._mp=this._maxMP},earnExp:function(a){this._exp+=a;if(this._level<this._player.max_levels&&this._exp>=this.getNextExp()){this._level++,this._attack+=this._player.attack_increase,this._defense+=this._player.defense_increase,this._maxHP+=this._player.maxHP_increase,this._maxMP+=this._player.maxMP_increase;return!0}return!1},earnGold:function(a){this._gold+=a},spendGold:function(a){this._gold-=a},equipWeapon:function(a){this._weapon=a},equipArmor:function(a){this._armor=a},equipHelmet:function(a){this._helmet=a},equipShield:function(a){this._shield=a},addToInventory:function(a,b){b==undefined&&(b=1),this._inventory[a]?this._inventory[a]+=b:this._inventory[a]=b},numInInventory:function(a){return parseInt(this._inventory[a])},removeFromInventory:function(a,b){b==undefined&&(b=1),this._inventory[a]-=b},forEachItemInInventory:function(a){for(var b in this._inventory)a(b,this._inventory[b])},learnSpell:function(a){this._spells.push(a)},forEachSpell:function(a){for(var b in this._spells)a(b)},createSaveData:function(){return{exp:this._exp,gold:this._gold,level:this._level,maxHP:this._maxHP,maxMP:this._maxMP,hp:this._hp,mp:this._mp,attack:this._attack,defense:this._defense,weapon:this._weapon,armor:this._armor,helmet:this._helmet,shield:this._shield,inventory:this._inventory,spells:this._spells,x:this._x,y:this._y,subMap:this._subMap,dir:this._dir}},loadSaveData:function(a){this._exp=a.exp,this._gold=a.gold,this._level=a.level,this._maxHP=a.maxHP,this._maxMP=a.maxMP,this._hp=a.hp,this._mp=a.mp,this._attack=a.attack,this._defense=a.defense,this._weapon=a.weapon,this._armor=a.armor,this._helmet=a.helmet,this._shield=a.shield,this._inventory=a.inventory,this._spells=a.spells,this._x=a.x,this._y=a.y,this._subMap=a.subMap,this._dir=a.dir}}),l=Class.extend({_init:function(a){this._monster=a,this._maxHP=a.hp,this._hp=a.hp,this._loc=0},getHP:function(){return this._hp},damage:function(a){this._hp-=a},heal:function(a){this._hp+=a,this._hp>this._maxHP&&(this._hp=this._maxHP)},isDead:function(){return this._hp<=0},getLoc:function(){return this._loc},setLoc:function(a){this._loc=a},getName:function(){return this._monster.name},getAttack:function(){return this._monster.attack},getDefense:function(){return this._monster.defense},getExp:function(){return this._monster.exp},getGold:function(){return this._monster.gold},getLeft:function(){return this._monster.left},getTop:function(){return this._monster.top},getWidth:function(){return this._monster.width},getHeight:function(){return this._monster.height},hasSpecialAttack:function(){return!!this._monster.special},useSpecialAttack:function(){this._monster.special(this)}}),m=Class.extend({_init:function(a,b,c,d){this._width=a,this._height=b,this._url=c,this._img=d},drawClip:function(a,b,c,d,e){var a=parseInt(a);a--;var f=_,g=ba,h=this._width/f,i=a%h*f,j=Math.floor(a/h)*g,k=b*f+d,l=c*g+e;bo.drawImage(this._img,i,j,f,g,k,l,f,g)}}),n=Class.extend({_init:function(){this._textDisplayed=!1,this._callback=null},setCallback:function(a){this._callback=a},textDisplayed:function(){return this._textDisplayed},displayText:function(a){bu.fillStyle="rgba(0, 0, 100, 0.75)",bu.fillRect(0,236,bt.width,100),bu.fillStyle="white",bu.font="bold 16px monospace",bu.textBaseline="top";var b=a.split("\n"),c=0;do bu.fillText(b[c],10,246+22*c);while(b.length>++c);this._textDisplayed=!0},clearText:function(){bu.clearRect(0,236,bt.width,100),this._textDisplayed=!1,this._callback&&(this._callback(),this._callback=null)}}),o=0,p=1,q=2,r=3,s=4,t=5,u=6,v=0,w=1,x=2,y=3,z=4,A=5,B=6,C=0,D=1,E=2,F=3,G=Class.extend({_init:function(){this._menuDisplayed=!1,this._currentMenu=o,this._currentAction=v,this._arrow=!1,this._lineHeight=[20,48,76,104,132,160],this._itemId=[],this._numItems=0,this._canUseItem=[],this._itemSelection=0,this._spellId=[],this._numSpells=0,this._canUseSpell=[],this._spellSelection=0,this._equipSelection=0,this._equipOptionSelection=0,this._numEquipOptions=0,this._equipHeight=[20,60,100,140],this._equipSubHeight=[220,240,260,280,300],this._equipOptionId=[]},menuDisplayed:function(){return this._menuDisplayed},displayMenu:function(){bG(bs,0,0,150,200,25,4),bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText("Item",42,this._lineHeight[0]),bu.fillText("Spell",42,this._lineHeight[1]),bu.fillText("Equip",42,this._lineHeight[2]),bu.fillText("Status",42,this._lineHeight[3]),bu.fillText("Save",42,this._lineHeight[4]),bu.fillText("Load",42,this._lineHeight[5]),this.drawArrow(),this._menuDisplayed=!0},clearMenu:function(){bs.clearRect(0,0,br.width,br.height),bu.clearRect(0,0,bt.width,bt.height),this._menuDisplayed=!1},displayNotImplementedMenu:function(){bG(bs,150,220,260,50,10,2),bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText("Not yet implemented.",163,235),this._currentMenu=t},clearNotImplementedMenu:function(){bs.clearRect(150,220,260,50),bu.clearRect(150,220,260,50),this._currentMenu=o},displayItemMenu:function(){bG(bs,150,0,250,200,25,4),bu.font="bold 20px monospace",bu.textBaseline="top",this._itemId=[],this._canUseItem=[];var a=0,b=this;bw.forEachItemInInventory(function(c,d){if(d>0){var e=cA.items[c].name,f=cA.items[c].type,g=d<10?" "+d:d;a<=6&&(f==bX?(bu.fillStyle="white",b._canUseItem[a]=!0):(bu.fillStyle="gray",b._canUseItem[a]=!1)),bu.fillText(e+":"+g,186,b._lineHeight[a]),b._itemId[a]=c,a++}}),this._numItems=a,this._currentMenu=p,a>0&&(this._itemSelection=0,this.drawItemSelection())},clearSubMenu:function(){bs.clearRect(150,0,250,200),bu.clearRect(150,0,250,200),this._currentMenu=o},displaySpellMenu:function(){bG(bs,150,0,250,200,25,4),bu.font="bold 20px monospace",bu.textBaseline="top",this._spellId=[],this._canUseSpell=[];var a=0,b=this;bw.forEachSpell(function(c){var d=cL.spells[c].name,e=cL.spells[c].type;a<=6&&(e==cH?(bu.fillStyle="white",b._canUseSpell[a]=!0):(bu.fillStyle="gray",b._canUseSpell[a]=!1)),bu.fillText(d,186,b._lineHeight[a]),b._spellId[a]=c,a++}),this._numSpells=a,this._currentMenu=q,a>0&&(this._spellSelection=0,this.drawSpellSelection())},displayEquipMenu:function(){bG(bs,150,0,250,200,25,4),bu.font="bold 16px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText("Weapon:",195,20),bu.fillText(cA.items[bw.getWeapon()].name,210,40),bu.fillText("Armor:",195,60),bu.fillText(cA.items[bw.getArmor()].name,210,80),bu.fillText("Helmet:",195,100),bu.fillText(cA.items[bw.getHelmet()].name,210,120),bu.fillText("Shield:",195,140),bu.fillText(cA.items[bw.getShield()].name,210,160),this.drawEquipSelection(),this._currentMenu=r},displayEquipSubMenu:function(){var a=-1;switch(this._equipSelection){case C:a=bZ;break;case D:a=b$;break;case E:a=b_;break;case F:a=ca}if(a!=-1){bG(bs,150,200,250,150,25,4),bu.font="bold 16px monospace",bu.fillStyle="white",bu.textBaseline="top",this._equipOptionId=[];var b=this,c=0;bw.forEachItemInInventory(function(d,e){if(e>0){var f=cA.items[d];f.type==a&&c<5&&(bu.fillText(f.name,195,b._equipSubHeight[c]),b._equipOptionId[c]=d,++c)}}),this._numEquipOptions=c,this._equipOptionSelection=0,this._currentMenu=u,c>0&&this.drawEquipOptionSelection()}},clearEquipSubMenu:function(){bs.clearRect(150,200,250,150),bu.clearRect(150,200,250,150),this._currentMenu=r},displayStatusMenu:function(){bG(bs,150,0,250,200,25,4),bu.font="bold 14px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText("HP:      "+bw.getHP()+"/"+bw.getMaxHP(),180,18),bu.fillText("MP:      "+bw.getMP()+"/"+bw.getMaxMP(),180,36),bu.fillText("Attack:  "+bw.getAttack(),180,54),bu.fillText("Defense: "+bw.getDefense(),180,72),bu.fillText("Level:   "+bw.getLevel(),180,90),bu.fillText("Exp:     "+bw.getExp()+"/"+bw.getNextExp(),180,108),bu.fillText("Gold:    "+bw.getGold(),180,126),this._currentMenu=s},drawArrow:function(){var a="►";bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top";var b=this._lineHeight[this._currentAction%B];bu.fillText(a,26,b),this._arrow=!0},clearArrow:function(){var a=this._lineHeight[this._currentAction%B];bu.clearRect(25,a,16,20),this._arrow=!1},drawItemSelection:function(){var a="►";bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(a,166,this._lineHeight[this._itemSelection])},clearItemSelection:function(){bu.clearRect(165,this._lineHeight[this._itemSelection],21,20)},drawSpellSelection:function(){var a="►";bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(a,166,this._lineHeight[this._spellSelection])},clearSpellSelection:function(){bu.clearRect(165,this._lineHeight[this._spellSelection],21,20)},drawEquipSelection:function(){var a="►";bu.font="bold 18px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(a,176,this._equipHeight[this._equipSelection])},clearEquipSelection:function(){bu.clearRect(175,this._equipHeight[this._equipSelection],19,18)},drawEquipOptionSelection:function(){var a="►";bu.font="bold 16px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(a,176,this._equipSubHeight[this._equipOptionSelection])},clearEquipOptionSelection:function(){bu.clearRect(175,this._equipSubHeight[this._equipOptionSelection],17,16)},handleInput:function(a){if(this._currentMenu==o){this.clearArrow();switch(a){case bH:case bK:this._currentAction++,this._currentAction%=B;break;case bI:case bJ:this._currentAction--,this._currentAction<0&&(this._currentAction+=B)}this.drawArrow()}else if(this._currentMenu==p&&this._numItems>0){this.clearItemSelection();switch(a){case bH:case bK:this._itemSelection++,this._itemSelection%=this._numItems;break;case bI:case bJ:this._itemSelection--,this._itemSelection<0&&(this._itemSelection+=this._numItems)}this.drawItemSelection()}else if(this._currentMenu==q&&this._numSpells>0){this.clearSpellSelection();switch(a){case bH:case bK:this._spellSelection++,this._spellSelection%=this._numSpells;break;case bI:case bJ:this._spellSelection--,this._spellSelection<0&&(this._spellSelection+=this._numSpells)}this.drawSpellSelection()}else if(this._currentMenu==r){this.clearEquipSelection();switch(a){case bH:case bK:this._equipSelection++,this._equipSelection%=4;break;case bI:case bJ:this._equipSelection--,this._equipSelection<0&&(this._equipSelection+=4)}this.drawEquipSelection()}else if(this._currentMenu==u){this.clearEquipOptionSelection();switch(a){case bH:case bK:this._equipOptionSelection++,this._equipOptionSelection%=this._numEquipOptions;break;case bI:case bJ:this._equipOptionSelection--,this._equipOptionSelection<0&&(this._equipOptionSelection+=this._numEquipOptions)}this.drawEquipOptionSelection()}},handleEnter:function(){if(this._currentMenu==o){this.clearArrow();switch(this._currentAction){case v:this.displayItemMenu();break;case w:this.displaySpellMenu();break;case x:this.displayEquipMenu();break;case y:this.displayStatusMenu();break;case z:bv.save(),this.clearSubMenu(),this.clearMenu();break;case A:this.clearSubMenu(),this.clearMenu();try{bv.load(),bq.clearRect(0,0,bp.width,bp.height),bx.goToMap(bw,bw.getSubMap(),bw.getX(),bw.getY(),bx.getScrollX(),bx.getScrollY(),bw.getDir())}catch(a){if(a instanceof P)bz.displayText("There is no saved game stored.");else if(a instanceof Q)bz.displayText("The game saved is from an old,\nincompatible version.");else throw a}}}else if(this._currentMenu==p&&this._numItems>0){if(this._canUseItem[this._itemSelection]){this.clearSubMenu(),this.clearMenu();var b=this._itemId[this._itemSelection],c=cA.items[b];c.use(bw),bw.removeFromInventory(b)}}else if(this._currentMenu==q&&this._numSpells>0){if(this._canUseSpell[this._spellSelection]){this.clearSubMenu(),this.clearMenu();var d=this._spellId[this._spellSelection],e=cL.spells[d];bw.getMP()>=e.mpCost?(e.use(bw),bw.useMP(e.mpCost)):bz.displayText("You do not have enough mp to use "+e.name+".")}}else this._currentMenu==r?this.displayEquipSubMenu():this._currentMenu==u&&this._numEquipOptions>0&&(this.clearEquipSubMenu(),this.changeEquip(),this.clearSubMenu(),this.displayEquipMenu())},handleEsc:function(){switch(this._currentMenu){case o:this.clearMenu();break;case p:case q:case r:case s:this.clearSubMenu(),this.drawArrow();break;case u:this.clearEquipSubMenu();break;case t:this.clearNotImplementedMenu(),this.drawArrow()}},changeEquip:function(){var a,b=this._equipOptionId[this._equipOptionSelection];switch(this._equipSelection){case C:a=bw.getWeapon(),bw.equipWeapon(b);break;case D:a=bw.getArmor(),bw.equipArmor(b);break;case E:a=bw.getHelmet(),bw.equipHelmet(b);break;case F:a=bw.getShield(),bw.equipShield(b)}bw.removeFromInventory(b),bw.addToInventory(a)}}),H=0,I=1,J=2,K=0,L=1,M=2,N=Class.extend({_init:function(){this._shopDisplayed=!1,this._currentMenu=H,this._currentAction=K,this._arrow=!1,this._lineHeight=[12,40,68],this._drawHeight=[40,60,80,100,120,140,160,180,200,220],this._itemList=null,this._buySelection=0,this._sellSelection=0,this._numItems=0,this._itemId=[]},shopDisplayed:function(){return this._shopDisplayed},displayShop:function(a){bG(bs,0,0,100,100,15,3),bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText("Buy",32,this._lineHeight[0]),bu.fillText("Sell",32,this._lineHeight[1]),bu.fillText("Exit",32,this._lineHeight[2]),this.displayGold(),this.drawArrow(),this._itemList=a,this._shopDisplayed=!0},clearShop:function(){bs.clearRect(0,0,br.width,br.height),bu.clearRect(0,0,bt.width,bt.height),this._itemList=null,this._shopDisplayed=!1,bz.displayText("Thank you for your business.\nPlease come again.")},displayGold:function(){bG(bs,0,120,100,40,10,2),bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(bw.getGold()+"G",16,130)},clearGold:function(){bs.clearRect(0,120,100,50),bu.clearRect(0,120,100,50)},drawArrow:function(){var a="►";bu.font="bold 20px monospace"
,bu.fillStyle="white",bu.textBaseline="top";var b=this._lineHeight[this._currentAction%3];bu.fillText(a,15,b),this._arrow=!0},clearArrow:function(){var a=this._lineHeight[this._currentAction%3];bu.clearRect(14,a,16,20),this._arrow=!1},displayBuyMenu:function(){bG(bs,100,0,300,300,40,5),bu.font="bold 16px monospace",bu.fillStyle="white",bu.textBaseline="top";for(var a=0;a<this._itemList.length;++a){var b=this._itemList[a],c=cA.items[b].name,d=cA.items[b].cost,e=c;while(e.length<15)e+=" ";var f=d.toString();while(f.length<5)f=" "+f;bu.fillText(e+" "+f+"G",144,this._drawHeight[a])}this._currentMenu=I,this._buySelection=0,this.drawBuySelection()},displaySellMenu:function(){bG(bs,100,0,300,300,40,5),bu.font="bold 14px monospace",bu.fillStyle="white",bu.textBaseline="top",this._itemId=[];var a=0,b=this;bw.forEachItemInInventory(function(c,d){if(d>0){var e=cA.items[c].name,f=cA.items[c].cost,g=Math.floor(f*.75),h=d>=10?d:" "+d,i=g.toString();while(i.length<5)i=" "+i;var j=e;while(j.length<15)j+=" ";a<10&&bu.fillText(j+" "+h+" "+i+"G",150,b._drawHeight[a]),b._itemId[a]=c,a++}}),this._numItems=a,this._currentMenu=J,a>0&&(this._sellSelection=0,this.drawSellSelection())},clearSubMenu:function(){bs.clearRect(100,0,300,300),bu.clearRect(100,0,300,300),this._currentMenu=H},drawBuySelection:function(){var a="►";bu.font="bold 16px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(a,128,this._drawHeight[this._buySelection])},clearBuySelection:function(){bu.clearRect(127,this._drawHeight[this._buySelection],17,16)},drawSellSelection:function(){var a="►";bu.font="bold 14px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(a,136,this._drawHeight[this._sellSelection])},clearSellSelection:function(){bu.clearRect(135,this._drawHeight[this._sellSelection],15,14)},handleInput:function(a){if(this._currentMenu==H){this.clearArrow();switch(a){case bH:case bK:this._currentAction++,this._currentAction%=3;break;case bI:case bJ:this._currentAction--,this._currentAction<0&&(this._currentAction+=3)}this.drawArrow()}else if(this._currentMenu==I){this.clearBuySelection();switch(a){case bH:case bK:this._buySelection++,this._buySelection%=this._itemList.length;break;case bI:case bJ:this._buySelection--,this._buySelection<0&&(this._buySelection+=this._itemList.length)}this.drawBuySelection()}else if(this._currentMenu==J&&this._numItems>0){this.clearSellSelection();switch(a){case bH:case bK:this._sellSelection++,this._sellSelection%=this._numItems;break;case bI:case bJ:this._sellSelection--,this._sellSelection<0&&(this._sellSelection+=this._numItems)}this.drawSellSelection()}},handleEnter:function(){if(this._currentMenu==H)switch(this._currentAction){case K:this.displayBuyMenu();break;case L:this.displaySellMenu();break;case M:this.clearShop()}else this._currentMenu==I?this.buyItem():this._currentMenu==J&&this._numItems>0&&this.sellItem()},handleEsc:function(){this._currentMenu==H?this.clearShop():this.clearSubMenu()},buyItem:function(){this.clearSubMenu();var a=this._itemList[this._buySelection],b=cA.items[a].name,c=cA.items[a].cost,d=bw.getGold();d>=c?(bw.spendGold(c),bw.addToInventory(a,1),bz.displayText("You purchased 1 "+b+" for "+c+"G."),this.clearGold(),this.displayGold()):bz.displayText("You do not have enough gold\nto buy a "+b+".\nYou only have "+d+"G.")},sellItem:function(){this.clearSubMenu();var a=this._itemId[this._sellSelection],b=cA.items[a].name,c=cA.items[a].cost,d=Math.floor(c*.75);bw.removeFromInventory(a),bw.earnGold(d),this.clearGold(),this.displayGold(),bz.displayText("You sold 1 "+b+" for "+d+"G.")}}),O=Class.extend({_init:function(){this._flags={},this._loadFunctions=[]},isFlagSet:function(a){return!!this._flags[a]},setFlag:function(a){this._flags[a]=!0},addLoadFunction:function(a){this._loadFunctions.push(a)},save:function(){amplify.store("save1_version",Z),amplify.store("save1_player",bw.createSaveData()),amplify.store("save1_worldmap",bx.createSaveData()),amplify.store("save1_game",bv.createSaveData())},load:function(){if(!amplify.store("save1_version"))throw new P;if(amplify.store("save1_version")!=Z)throw new Q;bw.loadSaveData(amplify.store("save1_player")),bx.loadSaveData(amplify.store("save1_worldmap")),bv.loadSaveData(amplify.store("save1_game"));for(var a=0;a<this._loadFunctions.length;++a)this._loadFunctions[a]()},createSaveData:function(){return this._flags},loadSaveData:function(a){this._flags=a}}),P=Class.extend({}),Q=Class.extend({}),R=0,S=1,T=2,U=3,V=4,W=0,X=1,Y=Class.extend({_init:function(){this._background=null,this._encounter=null,this._ignoringKeys=!1,this._monsterList=null,this._currentAction=R,this._currentMenu=W,this._over=!1,this._win=!1,this._line=0,this._txt="";var a=bn.height;this._lineHeight=[a-130,a-100,a-70,a-40],this._textHeight=[a-132,a-110,a-86,a-62,a-38],this._totalExp=0,this._totalGold=0,this._selectingMonster=!1,this._monsterSelection=0,this._onMonsterSelect=null,this._selectingItem=!1,this._itemSelection=0,this._itemId=[],this._numItems=0,this._selectingSpell=!1,this._spellSelection=0,this._spellId=[],this._numSpells=0,this._writing=!1,this._delay=0},setupRandomEncounter:function(a,b){this._background=b;var c=null;for(var d=0;d<cB.zones.length;++d)cB.zones[d].zone==a&&(c=cB.zones[d]);if(c!=null){var e=c.encounters.length,f=Math.floor(Math.random()*e);this._encounter=c.encounters[f],this._monsterList=[];for(var g=0;g<this._encounter.monsters.length;++g){var h=this._encounter.monsters[g];for(var i=0;i<cC.monsters.length;++i)if(cC.monsters[i].id==h){var j=new l(cC.monsters[i]);this._monsterList.push(j)}}}bP&&(this._ignoringKeys=!0)},setupEncounter:function(a,b,c){this._background=c,this._encounter={name:a,monsters:b},this._monsterList=[];for(var d=0;d<b.length;++d){var e=b[d];for(var f=0;f<cC.monsters.length;++f)if(cC.monsters[f].id==e){var g=new l(cC.monsters[f]);this._monsterList.push(g)}}bP&&(this._ignoringKeys=!0)},draw:function(){var a=bn.width,b=bn.height;bo.drawImage(this._background,0,0,a,b),bq.clearRect(0,0,a,b),this.drawPlayer(),this.drawHealthBar(),this.drawManaBar(),this.drawMonsters(),bG(bs,0,b-150,140,150,15,3),bG(bs,133,b-150,a-133,150,15,3),this._currentMenu=W,this.drawMenu(),this._currentAction=R,this.drawArrow(),bu.font="bold 16px sans-serif";var c=this._encounter.name+" appeared!";bu.fillText(c,154,this._textHeight[0]),this._line=1,this._txt=c},drawPlayer:function(){bq.drawImage(bw._img,bh,i*bi,bh,bi,bp.width-3*_,2*ba,bh,bi)},clearPlayer:function(){bq.clearRect(bp.width-3*_,2*ba,bh,bi)},drawMonsters:function(){var a=2*_;for(var b=0;b<this._monsterList.length;++b){var c=this._monsterList[b];bq.drawImage(by,c.getLeft(),c.getTop(),c.getWidth(),c.getHeight(),a,3*ba,c.getWidth(),c.getHeight()),c.setLoc(a),a+=c.getWidth()+15}},clearMonster:function(a){var b=this._monsterList[a];bq.clearRect(b.getLoc(),3*ba,b.getWidth(),b.getHeight())},drawHealthBar:function(){var a=bp.width-2*_+.5,b=2*ba+.5,c=10,d=bi,e=bw.getHP()/bw.getMaxHP();e<0&&(e=0);var f=b+Math.round((1-e)*d),g=d-(f-b);bq.fillStyle="red",bq.fillRect(a,f,c,g),bq.strokeStyle="black",bq.strokeRect(a,b,c,d)},drawManaBar:function(){var a=bp.width-2*_+10.5,b=2*ba+.5,c=10,d=bi,e=bw.getMP()/bw.getMaxMP();e<0&&(e=0);var f=b+Math.round((1-e)*d),g=d-(f-b);bq.fillStyle="#ccccff",bq.fillRect(a,f,c,g),bq.strokeStyle="black",bq.strokeRect(a,b,c,d)},clearHealthBar:function(){var a=bp.width-2*_+.5,b=2*ba+.5,c=10,d=bi;bq.clearRect(a,b,c,d)},clearManaBar:function(){var a=bp.width-2*_+10.5,b=2*ba+.5,c=10,d=bi;bq.clearRect(a,b,c,d)},updateHealthBar:function(a){this.clearHealthBar();var b=bp.width-2*_+.5,c=2*ba+.5,d=10,e=bi,f=a/bw.getMaxHP();f<0&&(f=0);var g=c+Math.round((1-f)*e),h=e-(g-c);bq.fillStyle="red",bq.fillRect(b,g,d,h),bq.strokeStyle="black",bq.strokeRect(b,c,d,e)},drawMenu:function(){bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top",this._currentMenu==W?(bu.fillText("Attack",36,this._lineHeight[0]),bu.fillText("Defend",36,this._lineHeight[1]),bu.fillText("Spell",36,this._lineHeight[2]),bu.fillText("Item",36,this._lineHeight[3])):bu.fillText("Run",36,this._lineHeight[0])},clearMenu:function(){bu.clearRect(36,this._lineHeight[0],114,bt.height-this._lineHeight[0])},writeMsg:function(a){this._writing=!0;var b=this._arrow;this.clearArrow(),this._arrow=b,window.setTimeout(function(){bC.drawText();var b=bC._line<=4?bC._line:4;bu.fillText(a,154,bC._textHeight[b]),bC._txt+="\n"+a,bC._line++,bC._delay-=bm,bC._delay==0&&(bC._writing=!1,bC._arrow&&bC.drawArrow())},this._delay),this._delay+=bm},drawText:function(){bu.font="bold 16px sans-serif",bu.fillStyle="white",bu.textBaseline="top",this.clearText();var a=this._txt.split("\n");if(this._line<=4)for(var b=0;b<this._line;++b)bu.fillText(a[b],154,this._textHeight[b]);else for(var b=0;b<4;++b){var c=a[a.length-4+b];bu.fillText(c,154,this._textHeight[b])}},clearText:function(){bu.clearRect(154,this._textHeight[0],bt.width-154,bt.height-this._textHeight[0])},end:function(){bs.clearRect(0,0,br.width,br.height),bq.clearRect(0,0,bp.width,bp.height),bu.clearRect(0,0,bt.width,bt.height),bx.redraw(),bx.drawSprites(),bw.plot(),this._win&&this.onWin(),this.onExit(),bC=null},drawArrow:function(){var a="►";bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top";var b=this._lineHeight[this._currentAction%4];bu.fillText(a,20,b),this._arrow=!0},clearArrow:function(){var a=this._lineHeight[this._currentAction%4];bu.clearRect(19,a,16,20),this._arrow=!1},drawMonsterSelection:function(){var a=this._monsterList[this._monsterSelection],b=a.getLoc(),c="►";bu.font="bold 20px monospace",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(c,b-10,3*ba)},clearMonsterSelection:function(){var a=this._monsterList[this._monsterSelection],b=a.getLoc();bu.clearRect(b-11,3*ba,16,20)},displayItems:function(){bu.font="bold 16px sans-serif",bu.fillStyle="white",bu.textBaseline="top";var a=0,b=this;bw.forEachItemInInventory(function(c,d){if(d>0){var e=cA.items[c];if(e.usable){var f=e.name,g=d<10?" "+d:d;a<=5&&bu.fillText(f+":"+g,180,b._textHeight[a]),b._itemId[a]=c,a++}}}),this._numItems=a},drawItemSelection:function(){var a="►";bu.font="bold 16px sans-serif",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(a,154,this._textHeight[this._itemSelection])},clearItemSelection:function(){bu.clearRect(153,this._textHeight[this._itemSelection],16,15)},displaySpells:function(){bu.font="bold 16px sans-serif",bu.fillStyle="white",bu.textBaseline="top";var a=0,b=this;bw.forEachSpell(function(c){var d=cL.spells[c].name;a<=5&&bu.fillText(d,174,b._textHeight[a]),b._spellId[a]=c,a++}),this._numSpells=a},drawSpellSelection:function(){var a="►";bu.font="bold 16px sans-serif",bu.fillStyle="white",bu.textBaseline="top",bu.fillText(a,154,this._textHeight[this._spellSelection])},clearSpellSelection:function(){bu.clearRect(153,this._textHeight[this._spellSelection],16,15)},handleInput:function(a){if(!this._writing&&!this._ignoringKeys)if(this._selectingMonster){this.clearMonsterSelection();switch(a){case bK:case bH:do this._monsterSelection++,this._monsterSelection>=this._monsterList.length&&(this._monsterSelection=0);while(this._monsterList[this._monsterSelection].isDead());break;case bJ:case bI:do this._monsterSelection--,this._monsterSelection<0&&(this._monsterSelection=this._monsterList.length-1);while(this._monsterList[this._monsterSelection].isDead())}this.drawMonsterSelection()}else if(this._selectingItem){this.clearItemSelection();switch(a){case bK:case bH:this._itemSelection++,this._itemSelection>=this._numItems&&(this._itemSelection=0);break;case bJ:case bI:this._itemSelection--,this._itemSelection<0&&(this._itemSelection=this._numItems-1)}this.drawItemSelection()}else if(this._selectingSpell){this.clearSpellSelection();switch(a){case bK:case bH:this._spellSelection++,this._spellSelection>=this._numSpells&&(this._spellSelection=0);break;case bJ:case bI:this._spellSelection--,this._spellSelection<0&&(this._spellSelection=this._numSpells-1)}this.drawSpellSelection()}else if(!this._over&&!bw.isDead()){this.clearArrow();switch(a){case bH:this._currentMenu==W&&(this._currentAction=(this._currentAction+1)%4);break;case bI:this._currentMenu==W&&(this._currentAction--,this._currentAction<0&&(this._currentAction+=4));break;case bJ:case bK:this._currentMenu=(this._currentMenu+1)%2,this.clearMenu(),this.drawMenu(),this._currentMenu==X?this._currentAction=V:this._currentAction=R}this.drawArrow()}},handleEnter:function(){if(!this._writing)if(this._selectingMonster)this.clearMonsterSelection(),this._selectingMonster=!1,this._onMonsterSelect(this._monsterSelection);else if(!bw.isDead())if(this._over)this.end();else{var a=!1,b=!0;if(this._selectingItem){this.clearItemSelection(),this._selectingItem=!1;var c=this.useItem();c||(b=!1,this.drawText())}else if(this._selectingSpell){this.clearSpellSelection(),this._selectingSpell=!1;var c=this.useSpell();c||(b=!1,this.drawText())}else switch(this._currentAction){case R:if(this._monsterList.length==1)this.attack(0);else{this._selectingMonster=!0,this.selectFirstLiveMonster();var d=this;this._onMonsterSelect=function(a){d.attack(a),d.finishTurn()},b=!1,this.drawMonsterSelection()}break;case S:this.writeMsg("You defended."),a=!0;break;case T:this._selectingSpell=!0,this.clearText(),this.displaySpells(),this.drawSpellSelection(),b=!1;break;case U:this._selectingItem=!0,this.clearText(),this.displayItems(),this.drawItemSelection(),b=!1;break;case V:this.run(),b=!1}!this._over&&b&&this.monsterTurn(a),this.runAfterWriting(function(){bC.clearHealthBar(),bC.clearManaBar(),bC.drawHealthBar(),bC.drawManaBar()})}},handleEsc:function(){this._selectingMonster?(this.clearMonsterSelection(),this._selectingMonster=!1):this._selectingItem?(this.clearItemSelection(),this._selectingItem=!1,this.drawText()):this._selectingSpell&&(this.clearSpellSelection(),this._selectingSpell=!1,this.drawText())},handleKeyUp:function(){this._ignoringKeys=!1},selectFirstLiveMonster:function(){for(var a=0;a<this._monsterList.length;++a)if(!this._monsterList[a].isDead()){this._monsterSelection=a;break}},finishTurn:function(){this._over||this.monsterTurn(!1),this.runAfterWriting(function(){bC.clearHealthBar(),bC.clearManaBar(),bC.drawHealthBar(),bC.drawManaBar()})},runAfterWriting:function(a){this._writing?window.setTimeout(function(){bC.runAfterWriting(a)}):a()},forEachMonster:function(a){for(var b=0;b<this._monsterList.length;++b)this._monsterList[b].isDead()||a(this._monsterList[b],b)},earnReward:function(a,b){var c=this;window.setTimeout(function(){c.clearMonster(b)},this._delay),this.writeMsg("The "+a.getName()+" was killed."),this._totalExp+=a.getExp(),this._totalGold+=a.getGold();for(var d=0;d<this._monsterList.length;++d)if(!this._monsterList[d].isDead())return;bw.earnGold(this._totalGold);var e=bw.earnExp(this._totalExp);this.writeMsg("You have earned "+this._totalExp+" exp"),this.writeMsg("and "+this._totalGold+" GP."),e&&this.writeMsg("You gained a level!"),this._over=!0,this._win=!0,this.clearArrow()},attack:function(a){var b=this._monsterList[a],c=Math.random();if(c>.95)this.writeMsg("You missed!");else{var d=bw.getAttack()-b.getDefense();c>.9&&(this.writeMsg("Critical Hit!"),d*=2),d<1&&(d=1),d-=Math.floor(Math.random()*d/2),this.writeMsg("You attacked for "+d+" damage."),b.damage(d),b.isDead()&&this.earnReward(b,a)}},monsterTurn:function(a){for(var b=0;b<this._monsterList.length;++b){var c=this._monsterList[b];if(!c.isDead()){if(c.hasSpecialAttack()&&Math.random()<.5)c.useSpecialAttack();else{var d=Math.random();if(d>.9)this.writeMsg("The "+c.getName()+" missed!");else{var e=c.getAttack()-bw.getDefense();d>.86&&(this.writeMsg("Terrible Hit!"),e=2*c.getAttack()-bw.getDefense()),a&&(e=Math.floor(e/2.5)),e<1&&(e=1),e-=Math.floor(Math.random()*e/2),bw.damage(e),this.writeMsg("The "+c.getName()+" attacked for"),this.writeMsg(e+" damage.");var f=this,g=bw.getHP();window.setTimeout(function(a){return function(){f.updateHealthBar(a)}}(g),this._delay)}}if(bw.isDead()){this.writeMsg("You died."),this._over=!0,this.clearArrow();var f=this;this.runAfterWriting(function(){f.clearPlayer()});return}}}},run:function(){if(Math.random()>=.33){this.writeMsg("You start to run."),this.monsterTurn(!1);if(bw.isDead()||this._over)return!1;if(Math.random()<.33){this.writeMsg("You couldn't run away.");return!1}}this.writeMsg("You ran away."),this._over=!0,this.clearArrow();var a=this;this.runAfterWriting(function(){a.clearPlayer()});return!0},useItem:function(){if(this._itemSelection<this._numItems){var a=this._itemId[this._itemSelection],b=cA.items[a];switch(b.type){case bX:b.use(bw);break;case bY:b.use()}bw.removeFromInventory(a);return!0}return!1},useSpell:function(){if(this._spellSelection<this._numSpells){var a=this._spellId[this._spellSelection],b=cL.spells[a];if(bw.getMP()>=b.mpCost){switch(b.type){case cH:b.use(bw);break;case cI:b.use()}bw.useMP(b.mpCost);return!0}this.writeMsg("You do not have enough MP"),this.writeMsg("to cast "+b.name+".")}return!1},onExit:function(){},onWin:function(){}}),Z="0.1pre 20110513",_=32,ba=32,bb=13,bc=11,bd=5,be=7,bf=4,bg=6,bh=32,bi=48,bj=25,bk=4,bl=.14,bm=500,bn=document.getElementById("mapCanvas"),bo=bn.getContext("2d"),bp=document.getElementById("spriteCanvas"),bq=bp.getContext("2d"),br=document.getElementById("menuCanvas"),bs=br.getContext("2d"),bt=document.getElementById("textCanvas"),bu=bt.getContext("2d"),bv=null,bw=null,bx=null,by=null,bz=new n,bA=new G,bB=new N,bC=null,bD=null,bH=40,bI=38,bJ=37,bK=39,bL=32,bM=13,bN=27,bO=0,bP=!1;window.opera||$.browser.mozilla?$(window).keypress(bQ):$(window).keydown(bQ),$(window).keyup(bR),$(document).ready(function(){var a=document.getElementById("showpad");a.onclick=function(){if(a.innerHTML=="Show Gamepad"){var b=document.getElementById("gamepad");b.style.display="block",a.innerHTML="Hide Gamepad";var c=document.getElementById("nokeyb");c.style.display="none"}else{var b=document.getElementById("gamepad");b.style.display="none",a.innerHTML="Show Gamepad";var c=document.getElementById("nokeyb");c.style.display="inline"}};var b=document.getElementById("upButton");b.onclick=function(a){bS(bI,a)};var c=document.getElementById("downButton");c.onclick=function(a){bS(bH,a)};var d=document.getElementById("leftButton");d.onclick=function(a){bS(bJ,a)};var e=document.getElementById("rightButton");e.onclick=function(a){bS(bK,a)};var f=document.getElementById("escButton");f.onclick=function(a){bS(bN,a)};var g=document.getElementById("enterButton");g.onclick=function(a){bS(bM,a)}}),$(document).ready(function(){bv=new O;var a="images/World3.png",b=new Image,d=new m(256,1152,a,b);b.src=a,b.onload=function(){bE("WorldMap1.tmx.xml",function(a){bx=new c(a,d);var b=new Image;bw=new k(23,13,b,0,h,cM),bx.goTo(17,8),b.onload=function(){bw.plot()},b.src="images/Trevor.png";var e=new Image;e.src="images/meadow.png";for(var f=0;f<bx.getXLimit();++f)for(var g=0;g<bx.getYLimit();++g){var i=bx.getSquareAt(f,g);i.passable()&&(i.onEnter=function(){if(Math.random()<bl){bO=0,bC=new Y;var a=this.getZone();bC.setupRandomEncounter(a,e),bC.draw()}})}var j="images/InqCastle.png",l=new Image,n=new m(256,2304,j,l);l.src=j,l.onload=function(){bE("Castle1.tmx.xml",function(a){bU(a,n)})};var o="images/Elfwood Forest.png",p=new Image,q=new m(256,576,o,p);p.src=o,p.onload=function(){bE("Forest1.tmx.xml",function(a){bW(a,q)})}})},by=new Image,by.src="images/enemies-t2.png"});var bX=1,bY=4,bZ=5,b$=6,b_=7,ca=8,cb=0,cc=1,cd=2,ce=10,cf=11,cg=12,ch=13,ci=14,cj=15,ck=16,cl=20,cm=21,cn=22,co=23,cp=24,cq=30,cr=31,cs=32,ct=33,cu=34,cv=40,cw=41,cx=42,cy=43,cz=44,cA={items:{0:{id:cb,name:"Potion",type:bX,cost:15,usable:!0,use:function(a){var b=100+Math.floor(Math.random()*100);a.heal(b),bF(a.getName()+" healed for "+b+" points.")}},1:{id:cc,name:"Bomb",type:bY,cost:35,usable:!0,use:function(){bC.forEachMonster(function(a,b){var c=50+Math.floor(Math.random()*100);c-=a.getDefense(),c<1&&(c=1),a.damage(c),bC.writeMsg("The "+a.getName()+" was hit for "),bC.writeMsg(c+" damage."),a.isDead()&&bC.earnReward(a,b)})}},2:{id:cd,name:"Ether",type:bX,cost:100,usable:!0,use:function(a){var b=25+Math.floor(Math.random()*25);a.gainMP(b),bF(a.getName()+" healed for "+b+" magic points.")}},10:{id:ce,name:"Tin Sword",type:bZ,cost:10,usable:!1,attack:5},11:{id:cf,name:"Copper Sword",type:bZ,cost:30,usable:!1,attack:10},12:{id:cg,name:"Bronze Sword",type:bZ,cost:90,usable:!1,attack:15},13:{id:ch,name:"Iron Sword",type:bZ,cost:270,usable:!1,attack:20},14:{id:ci,name:"Steel Sword",type:bZ,cost:810,usable:!1,attack:25},15:{id:cj,name:"Broad Sword",type:bZ,cost:2430,usable:!1,attack:30},16:{id:ck,name:"Great Sword",type:bZ,cost:7290,usable:!1,attack:35},20:{id:cl,name:"Clothes",type:b$,cost:10,usable:!1,defense:1},21:{id:cm,name:"Leather Armor",type:b$,cost:50,usable:!1,defense:4},22:{id:cn,name:"Chain Mail",type:b$,cost:250,usable:!1,defense:7},23:{id:co,name:"Half Plate Mail",type:b$,cost:1250,usable:!1,defense:10},24:{id:cp,name:"Full Plate Mail",type:b$,cost:6250,usable:!1,defense:13},30:{id:cq,name:"Cap",type:b_,cost:5,usable:!1,defense:1},31:{id:cr,name:"Leather Helmet",type:b_,cost:30,usable:!1,defense:2},32:{id:cs,name:"Bronze Helmet",type:b_,cost:150,usable:!1,defense:4},33:{id:ct,name:"Iron Helmet",type:b_,cost:600,usable:!1,defense:6},34:{id:cu,name:"Steel Helmet",type:b_,cost:1800,usable:!1,defense:8},40:{id:cv,name:"Tin Shield",type:ca,cost:35,usable:!1,defense:1},41:{id:cw,name:"Copper Shield",type:ca,cost:90,usable:!1,defense:2},42:{id:cx,name:"Bronze Shield",type:ca,cost:230,usable:!1,defense:4},43:{id:cy,name:"Iron Shield",type:ca,cost:700,usable:!1,defense:6},44:{id:cz,name:"Steel Shield",type:ca,cost:2100,usable:!1,defense:8}}},cB={zones:[{zone:"1",encounters:[{name:"A slime",monsters:[0]},{name:"A rat",monsters:[1]},{name:"A snake",monsters:[2]},{name:"2 slimes",monsters:[0,0]},{name:"3 slimes",monsters:[0,0,0]},{name:"A rat and a slime",monsters:[1,0]}]},{zone:"2",encounters:[{name:"3 snakes",monsters:[2,2,2]},{name:"3 blue slimes",monsters:[3,3,3]},{name:"A red slime",monsters:[5]},{name:"2 red slimes",monsters:[5,5]},{name:"A cocatrice",monsters:[4]},{name:"A white rat",monsters:[6]}]},{zone:"3",encounters:[{name:"2 red slimes",monsters:[5,5]},{name:"3 red slimes",monsters:[5,5,5]},{name:"A cocatrice",monsters:[4]},{name:"A white rat",monsters:[6]},{name:"A cobra",monsters:[7]},{name:"A wolf",monsters:[8]}]},{zone:"4",encounters:[{name:"2 cobras",monsters:[7,7]},{name:"2 wolves",monsters:[8,8]},{name:"3 cocatrices",monsters:[4,4,4]},{name:"3 white rats",monsters:[6,6,6]},{name:"A wolf and a cobra",monsters:[8,7]},{name:"A mage",monsters:[9]}]},{zone:"5",encounters:[{name:"2 cobras",monsters:[7,7]},{name:"2 wolves",monsters:[8,8]},{name:"3 cocatrices",monsters:[4,4,4]},{name:"3 white rats",monsters:[6,6,6]},{name:"A wolf and a cobra",monsters:[8,7]},{name:"A mage",monsters:[9]}]},{zone:"6",encounters:[{name:"2 cobras",monsters:[7,7]},{name:"2 wolves",monsters:[8,8]},{name:"3 cocatrices",monsters:[4,4,4]},{name:"3 white rats",monsters:[6,6,6]},{name:"A wolf and a cobra",monsters:[8,7]},{name:"A mage",monsters:[9]}]},{zone:"forest",encounters:[{name:"3 rats",monsters:[1,1,1]},{name:"A blue slime",monsters:[3]},{name:"2 blue slimes",monsters:[3,3]},{name:"A snake",monsters:[2]},{name:"A snake and a rat",monsters:[2,1]},{name:"A cocatrice",monsters:[4]}]}]},cC={monsters:[{id:0,name:"slime",hp:15,attack:10,defense:0,exp:5,gold:5,left:4,top:109,width:31,height:24},{id:1,name:"rat",hp:25,attack:15,defense:2,exp:10,gold:5,left:7,top:498,width:63,height:55},{id:2,name:"snake",hp:30,attack:20,defense:6,exp:15,gold:10,left:7,top:160,width:48,height:59},{id:3,name:"blue slime",hp:20,attack:20,defense:20,exp:20,gold:10,left:78,top:109,width:31,height:24},{id:4,name:"cocatrice",hp:45,attack:32,defense:16,exp:30,gold:30,left:14,top:329,width:47,height:67},{id:5,name:"red slime",hp:30,attack:30,defense:30,exp:30,gold:15,left:41,top:109,width:31,height:24},{id:6,name:"white rat",hp:55,attack:38,defense:20,exp:40,gold:30,left:145,top:498,width:63,height:55},{id:7,name:"cobra",hp:60,attack:42,defense:30,exp:40,gold:40,left:67,top:160,width:48,height:59},{id:8,name:"wolf",hp:68,attack:46,defense:28,exp:50,gold:25,left:7,top:685,width:47,height:55},{id:9,name:"mage",hp:100,attack:55,defense:20,exp:60,gold:40,left:640,top:153,width:32,height:33,special:function(a){var b=-1,c=9999;bC.writeMsg("The "+a.getName()+" casts Heal."),bC.forEachMonster(function(a,d){!a.isDead()&&a.getHP()<c&&(c=a.getHP(),b=d)});var d=bC._monsterList[b],e=50+Math.floor(Math.random()*50);d.heal(e),bC.writeMsg("The "+d.getName()+" was healed for "+e+".")}},{id:10,name:"rat king",hp:200,attack:55,defense:35,exp:120,gold:80,left:653,top:249,width:47,height:58}]},cD=0,cE=1,cF=2,cG=3,cH=1,cI=4,cJ=0,cK=1,cL={spells:[{id:cJ,name:"Heal",mpCost:5,type:cH,use:function(a){var b=100+Math.floor(Math.random()*100);a.heal(b),bF(a.getName()+" healed for "+b+" points.")}},{id:cK,name:"Bomb",mpCost:8,type:cI,use:function(){bC.forEachMonster(function(a,b){var c=50+Math.floor(Math.random()*100);c-=a.getDefense(),c<1&&(c=1),a.damage(c),bC.writeMsg("The "+a.getName()+" was hit for "),bC.writeMsg(c+" damage."),a.isDead()&&bC.earnReward(a,b)})}}]},cM=0,cN={players:[{id:0,name:"You",level:1,maxHP:100,maxMP:5,attack:12,defense:0,exp:0,gold:0,weapon:ce,armor:cl,helmet:cq,shield:cv,inventory:[],spells:[],levels:[0,50,110,200,350,600,1e3,1500,2250,3375,5e3,7500,11250,16875,25e3,37500,56250,84375,126500,189750,284625,426900,640350,960525,1440750,2161125,3241650,4862475,7293700,10940550,16410825],max_levels:30,maxHP_increase:20,maxMP_increase:5,attack_increase:2,defense_increase:1}]}